# 限流


阅读本文你将了解：

1. 什么是限流？
2. 常见的限流算法


## 什么是限流

限流主要解决： 请求总量超过了系统性能上限引发的系统崩溃问题。

流量限速（Rate Limit）的简称，是指只允许指定的事件进入系统，超过的部分将被拒绝服务、排队或等待、降级等处理。

通过保证一部分的请求流量可以得到正常的响应，总好过全部的请求都不能得到响应。



## 常见限流算法

<table>

<tr>
    <th> 算法 </th>
    <th> 核心思想 </th>
    <th> 优点 </th>
    <th> 缺点 </th>
    <th> 适用场景 </th>
</tr>

<tr>
    <td> 固定窗口计数器 </td>
    <td> 选取一个固定时间窗口如1s，设置一个限流阈值如1000qps。<br/>处理请求时先判断计数器是否超过阈值？若超过则丢弃或者延迟处理；若不超过则正常处理请求，并累加计数器。</td>
    <td> 实现简单 </td>
    <td> 无法应对流量突增的情况 </td>
    <td> 流量稳定的情况 </td>
</tr>

<tr>
    <td> 滑动窗口 </td>
    <td> 对固定窗口算法的改进。对固定窗口内进行划分，如1s为一个窗口，200ms为一个区间，则1个窗口有5个区间。每个区间都有一个计数器。<br/>每隔一段时间窗口右移一个区间，计算阈值时以窗口为单位，累积流量时以区间为单位。</td>
    <td> 更精细的控制流量，可以应对流量突增的情况 </td>
    <td> 实现相对复杂，需要维护信息增多，占用内存资源增对 </td>
    <td> 流量不均且需要平滑控制的场景 </td>
</tr>
<tr>
    <td> 漏桶算法 </td>
    <td> 生产-消费模式解耦请求与处理，设置一个固定大小的桶，无论请求速率快慢都丢到桶中，然后以固定速率处理桶中请求。若同满了则丢弃请求。 </td>
    <td> 平滑处理请求，固定输出速率，有效控制负载 </td>
    <td> 对突发流量的处理不够灵活，不能有效应对流量波动情况 </td>
    <td> 需要固定速率的场景<br/>防止系统雪崩的场景</td>
</tr>
<tr>
    <td> 令牌桶 </td>
    <td> 对漏桶算法的一种改进，还是设置一个桶，不在存放请求，而是存放令牌。以一定速率向桶中加入令牌，请求处理时下从桶中获取令牌，无令牌时丢弃处理。</td>
    <td> 平滑处理流量，可通过控制令牌生成速率控制流量限制 </td>
    <td> 实现复杂，需要增加令牌生成逻辑 </td>
    <td> 需要平滑流量<br/>需要动态控制流量限制的场景</td>
</tr>


</table>









